"use strict";

//npm configuration
/*
  "devDependencies": {
    "webpack": "3.10.0",
    "babel-core": "^6.26.0",
	"babel-loader": "^7.1.2",
	"babel-preset-env": "^1.6.1",
    "clean-webpack-plugin": "0.1.17",
    "path": "0.12.7"
  }
*/

//"webpack -p --env.production" --> for production build (you are basically setting the env variable below)

//*** note this example uses env.production vs setting the node env variable.
//to use the alternative "SET NODE_ENV=production&& webpack -p"...then in config below use console.log('Node Env = ', process.env.NODE_ENV);. I think using the web pack variables is better for now
//i like to use p because it minifies my code without pulling in more plugins

const path = require('path');
const CleanWebpackPlugin = require('clean-webpack-plugin');

module.exports = env => {

    const isProduction = env && env.production ? true : false;
    console.log('Production: ', isProduction);

    return {

        entry: {
            Entry1: './App/MyEntryPoint1.js',
            Entry2: './App/MyEntryPoint2.js',
        },

        output: {
            filename: './wwwroot/Build/[name].Bundle.js'
        },

        devtool: isProduction ? 'none' : 'source-map',

       module: {
            rules: [
                {
                    test: /\.js$/,
                    exclude: /(node_modules|bower_components)/,
                    use: {
                        loader: 'babel-loader',
                        options: {
                            presets: ['babel-preset-env']
                        }
                    }
                }
            ]
        },

        plugins:
        [
            //this just cleans up the output folder so we don't have left over items that shouldn't be there.
            new CleanWebpackPlugin([path.join(__dirname, '/wwwroot/Build/*.*')]), //removes all files in this directory. Or you can do '/wwwroot/Build/**.js' if you want to delete just the js files
        ]
    };
};